# Synapse A2A プロジェクト哲学

## ミッション

**A2A（Agent-to-Agent）プロトコルの可能性を探求し、既存の CLI エージェントを A2A エコシステムに参加させるための実験的フレームワークを提供する。**

## 核心原則

### 1. A2A プロトコル完全準拠（A2A-First）

Synapse A2A は「A2A プロトコルでできること」を最大限に活かすことを最優先とする。

- **すべての通信は A2A フォーマット**: Message/Part + Task 形式
- **標準エンドポイント**: `/.well-known/agent.json`, `/tasks/send`, `/tasks/{id}`
- **拡張は `x-` プレフィックス**: 独自機能も A2A の拡張機構に準拠

**例**: システムコンテキストの伝達
- ❌ CLI 固有の `--system-prompt` オプション
- ❌ 環境変数 `ANTHROPIC_SYSTEM_PROMPT`
- ✅ Agent Card の `x-synapse-context` 拡張（A2A 準拠）

### 2. CLI をそのまま活用（Non-Invasive）

既存の CLI ツール（Claude Code, Gemini CLI 等）を改造せずにエージェント化する。

- **PTY ラッピング**: CLI の入出力を透過的にラップ
- **プロファイルベース**: YAML 設定で異なる CLI に対応
- **透過的引数パススルー**: `synapse claude -- --resume` のように引数を渡す

### 3. 実験と検証（Experimental Validation）

A2A プロトコルの実用性と限界を実際の実装を通じて検証する。

- **検証項目**:
  - マルチエージェント協調の実現可能性
  - プロトコルの表現力と制約
  - リアルワールドでのユースケース適合性

- **フィードバックループ**:
  - 実装 → 課題発見 → 設計改善 → 再実装

### 4. 最小限の表示（Minimal Visibility）

ユーザーの端末は作業空間であり、システムメッセージで汚染しない。

- **ブートストラップは最小限**: 長いインストラクションより短いコマンド
- **A2A 経由の情報取得**: Agent Card からコンテキストを取得
- **ログは別ファイル**: `~/.synapse/logs/` に保存

## 設計判断の基準

新機能や変更を検討する際の判断基準：

| 判断軸 | 優先 | 避ける |
|--------|------|--------|
| プロトコル | A2A 準拠のアプローチ | CLI 固有のハック |
| 実装 | 標準機構の活用 | 独自プロトコルの発明 |
| ユーザー体験 | 透過的・最小限 | 煩雑・侵入的 |
| 検証 | 実際に動作するもの | 理論のみ |

## A2A プロトコルへの貢献

Synapse A2A を通じて得られた知見は、A2A プロトコル自体の改善に還元する。

### 発見した課題と提案

1. **システムコンテキストの標準化**
   - 現状: `extensions` での独自実装
   - 提案: Agent Card に `system_context` フィールドを標準化

2. **サイレントメッセージ**
   - 現状: すべての Task がエージェントの stdin に書き込まれる
   - 提案: メタデータのみの Task タイプ（表示不要）

3. **Priority Interrupt**
   - 現状: Synapse 独自拡張
   - 提案: Task に `interrupt` フラグを標準化

## ロードマップとの整合性

[tasks/a2a/README.md](../tasks/a2a/README.md) のロードマップは、この哲学に基づいて優先順位付けされている：

- **Phase 1 (高優先度)**: A2A 基本機能の完成
- **Phase 2 (中優先度)**: UX 改善（ストリーミング等）
- **Phase 3 (低優先度)**: エンタープライズ機能（認証等）

## 参加と貢献

このプロジェクトは A2A プロトコルの可能性を探求する実験場です。

- 新しいユースケースの提案
- プロトコル準拠性の検証
- 実装改善のフィードバック

すべての貢献を歓迎します。
